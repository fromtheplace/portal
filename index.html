<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FROM THE PLACE — CHANNEL GUIDE</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=Barlow+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:         #0b0a08;
  --surface:    #111009;
  --surface-2:  #181611;
  --border:     #252218;
  --border-hi:  #35301f;
  --amber:      #c8943a;
  --amber-dim:  #5e420f;
  --amber-pale: #e8c882;
  --red:        #bf2e2e;
  --red-dim:    #4a1212;
  --text:       #a89c82;
  --text-dim:   #4a4232;
  --text-hi:    #e0d4b8;
  --text-lo:    #2a2418;
  --font-disp:  'VT323', monospace;
  --font-mono:  'Share Tech Mono', monospace;
  --font-cond:  'Barlow Condensed', sans-serif;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { height: 100%; }
body {
  min-height: 100%; background: var(--bg); color: var(--text);
  font-family: var(--font-mono); font-size: 13px; line-height: 1.5; overflow-x: hidden;
}
body::after {
  content: ''; position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='g'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23g)' opacity='0.04'/%3E%3C/svg%3E");
  background-size: 256px; pointer-events: none; z-index: 999; mix-blend-mode: overlay;
}
body::before {
  content: ''; position: fixed; inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,0,0,0.06) 3px, rgba(0,0,0,0.06) 4px);
  pointer-events: none; z-index: 998;
}

/* MASTHEAD */
#masthead {
  position: sticky; top: 0; z-index: 100;
  display: flex; align-items: stretch;
  border-bottom: 1px solid var(--border);
  background: var(--surface); height: 100px;
}
.mast-logo-cell {
  display: flex; align-items: center; justify-content: center;
  padding: 8px 18px; border-right: 1px solid var(--border); flex-shrink: 0;
}
.mast-logo-cell img {
  height: 80px; width: auto; display: block;
  filter: brightness(0.92) contrast(1.05);
}
.mast-center {
  flex: 1; display: flex; align-items: center; justify-content: center; gap: 20px;
}
.mast-on-air {
  display: flex; align-items: center; gap: 6px;
  padding: 3px 10px; border: 1px solid var(--red-dim); background: rgba(191,46,46,0.07);
}
.on-air-dot {
  width: 5px; height: 5px; border-radius: 50%; background: var(--red);
  animation: dot-pulse 1.4s ease-in-out infinite;
}
@keyframes dot-pulse {
  0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(191,46,46,0.5)}
  50%{opacity:0.5;box-shadow:0 0 0 5px rgba(191,46,46,0)}
}
.on-air-text { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.28em; color: var(--red); text-transform: uppercase; }
.mast-clock { font-family: var(--font-disp); font-size: 28px; color: var(--text-dim); letter-spacing: 0.1em; }
.mast-right { display: flex; align-items: center; padding: 0 18px; border-left: 1px solid var(--border); flex-shrink: 0; }
.mast-btn { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.25em; color: var(--text-dim); text-transform: uppercase; text-decoration: none; transition: color 0.15s; white-space: nowrap; }
.mast-btn:hover { color: var(--amber); }

/* HERO STRIP */
#hero-strip {
  border-bottom: 1px solid var(--border); background: var(--surface-2);
  padding: 7px 24px; display: flex; align-items: center; gap: 14px; min-height: 36px;
}
.hs-ch { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.35em; color: var(--text-dim); text-transform: uppercase; white-space: nowrap; flex-shrink: 0; }
.hs-track { font-family: var(--font-disp); font-size: 21px; color: var(--text-hi); letter-spacing: 0.04em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }
.hs-ctx { font-family: var(--font-mono); font-size: 9px; color: var(--text-dim); letter-spacing: 0.12em; white-space: nowrap; flex-shrink: 0; }

/* MAIN */
#main { padding: 24px; max-width: 1400px; margin: 0 auto; }
.section-head { display: flex; align-items: baseline; gap: 10px; margin-bottom: 14px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
.section-head-label { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.4em; color: var(--text-dim); text-transform: uppercase; }
.section-head-count { font-family: var(--font-disp); font-size: 20px; color: var(--amber-dim); }

/* CHANNEL GRID */
#channel-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1px; background: var(--border); border: 1px solid var(--border); }

/* CHANNEL CARD */
.ch-card {
  background: var(--surface); display: block; text-decoration: none; color: inherit;
  position: relative; cursor: pointer; outline: none;
  border-left: 3px solid transparent; transition: background 0.12s, border-color 0.12s;
}
.ch-card:hover    { background: var(--surface-2); border-left-color: var(--amber-dim); }
.ch-card.featured { background: var(--surface-2); border-left-color: var(--amber); }
.ch-card:focus-visible { outline: 2px solid var(--amber-dim); outline-offset: -2px; }

/* THUMB AREA */
.ch-thumb { scale: 0.9;
  border: solid white 1px;
  border-radius: 19px;
           position: relative; width: 100%; padding-top: 56.25%; background: #000; overflow: hidden; }

/* Static cover — visible at rest */
.ch-thumb-static {
  position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: block;
  filter: sepia(0.45) brightness(0.75) contrast(1.08) saturate(0.8);
  transition: opacity 0.28s ease;
}
/* Live YT thumb — hidden at rest, cross-fades in on hover */
.ch-thumb-live {
  position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;
  opacity: 0; transition: opacity 0.3s ease;
  filter: brightness(0.9) contrast(1.05);
}
.ch-card:hover .ch-thumb-live.ready { opacity: 1; }
.ch-card:hover .ch-thumb-static     { opacity: 0; }

/* fallback */
.ch-thumb-fb { z-index: -50;   position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #0c0a07 0%, #1a1610 100%); }
.ch-thumb-fb-num { font-family: var(--font-disp); font-size: 56px; color: var(--text-lo); letter-spacing: -3px; line-height: 1; }

/* gradient over bottom of thumb */
.ch-thumb::after { content: ''; position: absolute; inset: 0; background: linear-gradient(0deg, rgba(8,7,5,0.78) 0%, transparent 55%); pointer-events: none; z-index: 2; }

/* badges */
.ch-live { position: absolute; top: 7px; left: 8px; z-index: 3; display: flex; align-items: center; gap: 4px; background: rgba(191,46,46,0.88); padding: 2px 6px; font-family: var(--font-mono); font-size: 7px; letter-spacing: 0.22em; color: #fff; text-transform: uppercase; }
.ch-live::before { content: ''; width: 4px; height: 4px; border-radius: 50%; background: #fff; animation: blink 1.1s step-end infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
.ch-live.off { display: none; }
.ch-num-overlay { position: absolute; bottom: 7px; right: 9px; z-index: 3; font-family: var(--font-disp); font-size: 17px; color: rgba(255,255,255,0.2); letter-spacing: 0.05em; pointer-events: none; }
.ch-on-air { position: absolute; top: 7px; right: 8px; z-index: 3; font-family: var(--font-mono); font-size: 7px; letter-spacing: 0.18em; color: var(--amber); border: 1px solid rgba(200,148,58,0.4); background: rgba(200,148,58,0.1); padding: 2px 6px; text-transform: uppercase; display: none; }
.ch-card.featured .ch-on-air { display: block; }

/* NOW PLAYING overlay on thumb bottom */
.ch-np { position: absolute; bottom: 0; left: 0; right: 0; z-index: 4; padding: 6px 9px 7px; pointer-events: none; }
.ch-np-label { font-family: var(--font-mono); font-size: 7px; letter-spacing: 0.28em; color: rgba(200,148,58,0.65); text-transform: uppercase; line-height: 1; margin-bottom: 2px; }
.ch-np-text { font-family: var(--font-disp); font-size: 16px; color: rgba(240,232,216,0.9); letter-spacing: 0.04em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.1; }
.ch-np-text.loading { color: rgba(255,255,255,0.18); font-size: 11px; letter-spacing: 0.2em; }
.ch-np-text.error   { color: rgba(255,255,255,0.12); font-size: 11px; letter-spacing: 0.15em; }

/* CARD META */
.ch-meta { padding: 9px 12px 11px; display: grid; grid-template-columns: 36px 1fr; gap: 0 10px; align-items: start; }
.ch-num { font-family: var(--font-disp); font-size: 28px; color: var(--text-dim); line-height: 1; padding-top: 2px; text-align: right; transition: color 0.12s; }
.ch-card:hover .ch-num, .ch-card.featured .ch-num { color: var(--amber); }
.ch-name { font-family: var(--font-cond); font-weight: 700; font-size: 13px; letter-spacing: 0.08em; color: var(--text-hi); text-transform: uppercase; line-height: 1.15; }
.ch-desc { font-family: var(--font-mono); font-size: 9px; color: var(--text-dim); margin-top: 2px; letter-spacing: 0.04em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ch-tag { display: inline-block; margin-top: 4px; font-family: var(--font-mono); font-size: 7px; letter-spacing: 0.2em; color: var(--amber-dim); border: 1px solid var(--border-hi); padding: 1px 5px; text-transform: uppercase; }

/* FOOTER */
#footer { border-top: 1px solid var(--border); padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; background: var(--surface); margin-top: 32px; }
.footer-sig { font-family: var(--font-mono); font-size: 8px; letter-spacing: 0.28em; color: var(--text-dim); text-transform: uppercase; }
.footer-ch  { font-family: var(--font-disp); font-size: 20px; color: var(--text-lo); letter-spacing: 0.1em; }

@media (max-width: 700px) { #channel-grid { grid-template-columns: 1fr 1fr; } #main { padding: 12px; } .mast-center { display: none; } }
@media (max-width: 440px) { #channel-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<header id="masthead">
  <div class="mast-logo-cell">
    
    <img src="images/ftptv.png" alt="FTP TV">
  </div>
  <div class="mast-center">
    <div class="mast-on-air"><div class="on-air-dot"></div><div class="on-air-text">On Air</div></div>
    <div class="mast-clock" id="clock">00:00:00</div>
  </div>
  <div class="mast-right">
    <a class="mast-btn" href="channel.html">↗ CH 01 LIVE</a>
  </div>
</header>

<div id="hero-strip">
  <span class="hs-ch" id="hs-ch">CH 01</span>
  <span class="hs-track" id="hs-track">—</span>
  <span class="hs-ctx" id="hs-ctx"></span>
</div>

<main id="main">
  <div class="section-head">
    <span class="section-head-label">Channels</span>
    <span class="section-head-count" id="ch-count"></span>
  </div>
  <div id="channel-grid"></div>
</main>

<footer id="footer">
  <div class="footer-sig">From The Place · Ōtepoti Music Television</div>
  <div class="footer-ch" id="footer-range">—</div>
</footer>

<script src="FTP_MEGA.js"></script>
<script>
// ══════════════════════════════════════════════════════════════════
//  CHANNEL REGISTRY
//
//  To add a new channel with the same stack as FTP/NookTV:
//    1. Add an entry below
//    2. Set nowPlaying: { type: 'fetchjs', url: 'https://.../*_MEGA.js', varName: 'videoPlaylist' }
//    3. Set thumb or thumbId for the cover image
//    Done. Now-playing and hover thumbnails resolve automatically.
//
//  THUMBNAIL FIELDS:
//    thumb   — custom image URL or local path. Highest priority.
//    thumbId — YouTube video ID. Static cover + live hover thumb source.
//
//  NOW PLAYING TYPES:
//    { type: 'ftpengine', playlist: <array> }   — local playlist already loaded
//    { type: 'fetchjs', url, varName }          — fetch remote *_MEGA.js and compute
//    { type: 'static', text }                   — fixed string
//    null                                       — no now-playing shown
// ══════════════════════════════════════════════════════════════════
const CHANNELS = [
  {
    num:      1,
    name:     'FTP LIVE',
    tag:      'LIVE BROADCAST',
    desc:     'Ōtepoti Music Television — continuous live stream',
    live:     true,
    href:     'channel.html',
    featured: true,
    thumb:    null,
    thumbId:  null,        // set at runtime from live playlist
    nowPlaying: { type: 'ftpengine', playlist: null }, // filled after script loads
  },
  {
    num:      2,
    name:     'NOOK & CRANNY',
    tag:      'LIVE',
    desc:     'Nook & Cranny TV — Ōtepoti',
    live:     true,
    href:     'https://fromtheplace.github.io/nooktv/',
    featured: false,
    thumb:    null,
    thumbId:  null,        // will come from live playlist fetch
    nowPlaying: {
      type:    'fetchjs',
      url:     'https://fromtheplace.github.io/nooktv/NOOK_MEGA.js',
      varName: 'videoPlaylist',
    },
  },
  {
    num:      3,
    name:     'FTPtv2',
    tag:      'ARCHIVE',
    desc:     'Full sets',
    live:     true,
    href:     'https://fromtheplace.github.io/ftptv/',
    featured: false,
    thumb:    null,           // e.g. 'images/ohhh-cover.jpg'
    thumbId:  'xX6NIpgr8WA',
    nowPlaying: {
      type:    'fetchjs',
      url:     'https://fromtheplace.github.io/ftptv/FTP_MEGA.js',
      varName: 'videoPlaylist',
    },
    },
];

// Wire CH1's local playlist (already available from FTP_MEGA.js <script> above)
CHANNELS[0].nowPlaying.playlist = videoPlaylist;

// ══════════════════════════════════════════════════════════════════
//  LIVE POSITION ENGINE  (same logic as channel.html)
// ══════════════════════════════════════════════════════════════════
function getLivePosition(playlist) {
  const total  = playlist.reduce((s,t) => s + Math.max(0, t.end - t.start), 0);
  if (!total) return { index: 0 };
  const nowSec = Math.floor(Date.now() / 1000);
  const dayNum = Math.floor(nowSec / 86400);
  const seed   = Number((BigInt(dayNum % total) * 3571n) % BigInt(total));
  const pos    = ((nowSec % total) + seed) % total;
  let elapsed  = 0;
  for (let i = 0; i < playlist.length; i++) {
    const len = playlist[i].end - playlist[i].start;
    if (pos < elapsed + len) return { index: i, seekOffset: pos - elapsed };
    elapsed += len;
  }
  return { index: 0, seekOffset: 0 };
}

function parseTitle(title) {
  const sep   = title.includes('—') ? '—' : ' - ';
  const parts = title.split(sep);
  return {
    artist:  parts[0].trim(),
    context: parts.slice(1).join(sep).replace(/\[.*?\]/g,'').replace(/#\w+/g,'').trim(),
  };
}

function playlistNowPlaying(playlist) {
  const { index } = getLivePosition(playlist);
  const track     = playlist[index];
  if (!track) return { text: '—', videoId: null };
  const p = parseTitle(track.title);
  return {
    text:    p.artist + (p.context ? ' — ' + p.context : ''),
    videoId: track.id,
  };
}

// ══════════════════════════════════════════════════════════════════
//  REMOTE PLAYLIST FETCH
//  Fetches a *_MEGA.js from any URL, evals the playlist var.
//  Cached per URL. CORS-safe because GitHub Pages sends permissive headers.
// ══════════════════════════════════════════════════════════════════
const _cache = {};

async function fetchRemotePlaylist(url, varName) {
  if (_cache[url]) return _cache[url];
  try {
    const res  = await fetch(url, { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const text = await res.text();
    // Evaluate in isolated function scope — no globals polluted
    const fn   = new Function(`${text}; return typeof ${varName} !== 'undefined' ? ${varName} : null;`);
    const arr  = fn();
    if (!Array.isArray(arr) || !arr.length) throw new Error('No array found');
    _cache[url] = arr;
    return arr;
  } catch (e) {
    console.warn(`[portal] fetchRemotePlaylist(${url}):`, e.message);
    return null;
  }
}

// ══════════════════════════════════════════════════════════════════
//  RESOLVE NOW PLAYING — works for any channel type
// ══════════════════════════════════════════════════════════════════
async function resolveNowPlaying(ch) {
  const np = ch.nowPlaying;
  if (!np) return null;

  if (np.type === 'ftpengine') {
    const pl = np.playlist;
    if (!pl?.length) return null;
    return playlistNowPlaying(pl);
  }

  if (np.type === 'fetchjs') {
    const pl = await fetchRemotePlaylist(np.url, np.varName || 'videoPlaylist');
    if (!pl) return null;
    return playlistNowPlaying(pl);
  }

  if (np.type === 'static') {
    return { text: np.text, videoId: null };
  }

  return null;
}

// ══════════════════════════════════════════════════════════════════
//  THUMBNAILS
// ══════════════════════════════════════════════════════════════════
function ytThumb(id, q) { return `https://i.ytimg.com/vi/${id}/${q}.jpg`; }

function loadYtThumb(img, videoId, onDone) {
  img.onerror = () => {
    img.onerror = () => { onDone && onDone(false); };
    img.src = ytThumb(videoId, 'hqdefault');
  };
  img.onload  = () => { onDone && onDone(true); };
  img.src     = ytThumb(videoId, 'maxresdefault');
}

// ══════════════════════════════════════════════════════════════════
//  BUILD GRID
// ══════════════════════════════════════════════════════════════════
const cardMap = {}; // ch.num → card element, for refresh

function buildGrid() {
  const grid = document.getElementById('channel-grid');
  grid.innerHTML = '';
  document.getElementById('ch-count').textContent = CHANNELS.length;
  const nums = CHANNELS.map(c => c.num);
  document.getElementById('footer-range').textContent =
    `CH ${String(Math.min(...nums)).padStart(2,'0')}–${String(Math.max(...nums)).padStart(2,'0')}`;
  CHANNELS.forEach(ch => buildCard(ch, grid));
}

function buildCard(ch, grid) {
  // Resolve static thumb src (custom path takes priority over thumbId)
  const staticSrc = ch.thumb
    ? ch.thumb
    : ch.thumbId
      ? ytThumb(ch.thumbId, 'hqdefault')
      : null;

  const card = document.createElement('a');
  card.className      = 'ch-card' + (ch.featured ? ' featured' : '');
  card.href           = ch.href;
  card.dataset.chNum  = ch.num;
  card.setAttribute('role', 'listitem');
  card.setAttribute('tabindex', '0');
  card.setAttribute('aria-label', `Channel ${ch.num}: ${ch.name}`);

  card.innerHTML = `
    <div class="ch-thumb">
      ${staticSrc
        ? `<img class="ch-thumb-static" src="${staticSrc}" alt="${ch.name}" loading="lazy">`
        : ''}
      <img class="ch-thumb-live" alt="" aria-hidden="true">
      <div class="ch-thumb-fb"${staticSrc ? ' style="display:none"' : ''}>
        <div class="ch-thumb-fb-num">${String(ch.num).padStart(2,'0')}</div>
      </div>
      <div class="ch-live${ch.live ? '' : ' off'}">LIVE</div>
      <div class="ch-on-air">ON AIR</div>
      <div class="ch-num-overlay">CH ${String(ch.num).padStart(2,'0')}</div>
      <div class="ch-np">
        <div class="ch-np-label">Now Playing</div>
        <div class="ch-np-text loading" data-np>···</div>
      </div>
    </div>
    <div class="ch-meta">
      <div class="ch-num">${String(ch.num).padStart(2,'0')}</div>
      <div class="ch-info">
        <div class="ch-name">${ch.name}</div>
        <div class="ch-desc">${ch.desc}</div>
        ${ch.tag ? `<div class="ch-tag">${ch.tag}</div>` : ''}
      </div>
    </div>
  `;

  // Static thumb error → show fallback plate
  const staticImg = card.querySelector('.ch-thumb-static');
  const fb        = card.querySelector('.ch-thumb-fb');
  if (staticImg) {
    staticImg.addEventListener('error', () => {
      staticImg.style.display = 'none';
      fb.style.display = '';
    });
  }

  // Live thumb on hover — lazy loaded on first mouseenter
  const liveImg = card.querySelector('.ch-thumb-live');
  let liveLoaded  = false;
  // liveVideoId starts as thumbId, then gets overridden by now-playing resolve
  let liveVideoId = ch.thumbId;

  card.addEventListener('mouseenter', () => {
    if (liveLoaded || !liveVideoId) return;
    liveLoaded = true;
    loadYtThumb(liveImg, liveVideoId, ok => {
      if (ok) liveImg.classList.add('ready');
    });
  });

  grid.appendChild(card);
  cardMap[ch.num] = card;

  // Resolve now-playing async
  resolveNowPlaying(ch).then(result => {
    const npEl = card.querySelector('[data-np]');
    if (!npEl) return;

    if (!ch.nowPlaying) {
      npEl.textContent = '—';
      npEl.classList.remove('loading');
      return;
    }

    if (result?.text) {
      npEl.textContent = result.text;
      npEl.classList.remove('loading');
    } else {
      npEl.textContent = 'signal lost';
      npEl.classList.remove('loading');
      npEl.classList.add('error');
    }

    // Use the live video ID for hover thumb (more accurate than a fixed thumbId)
    if (result?.videoId) {
      liveVideoId = result.videoId;
      // For CH1 (featured), also update static thumb to current live frame
      if (ch.featured && staticImg) {
        const liveSrc = ytThumb(result.videoId, 'hqdefault');
        if (staticImg.src !== liveSrc) staticImg.src = liveSrc;
      }
    }
  });
}

// ══════════════════════════════════════════════════════════════════
//  HERO STRIP — now playing on featured channel
// ══════════════════════════════════════════════════════════════════
async function updateHeroStrip() {
  const featured = CHANNELS.find(c => c.featured) || CHANNELS[0];
  document.getElementById('hs-ch').textContent = `CH ${String(featured.num).padStart(2,'0')} / Now Playing`;
  const result = await resolveNowPlaying(featured);
  if (!result?.text) return;
  const p = parseTitle(result.text);
  document.getElementById('hs-track').textContent = p.artist || result.text;
  document.getElementById('hs-ctx').textContent   = p.context || '';
}

// ══════════════════════════════════════════════════════════════════
//  REFRESH — re-resolve now-playing on all cards without full rebuild
// ══════════════════════════════════════════════════════════════════
function refreshNowPlaying() {
  CHANNELS.forEach(ch => {
    const card = cardMap[ch.num];
    if (!card) return;
    const npEl = card.querySelector('[data-np]');
    if (!npEl) return;
    npEl.textContent = '···';
    npEl.classList.add('loading');
    npEl.classList.remove('error');
    resolveNowPlaying(ch).then(result => {
      if (result?.text) {
        npEl.textContent = result.text;
        npEl.classList.remove('loading');
      } else {
        npEl.textContent = ch.nowPlaying ? 'signal lost' : '—';
        npEl.classList.remove('loading');
        if (ch.nowPlaying) npEl.classList.add('error');
      }
    });
  });
  updateHeroStrip();
}

// ══════════════════════════════════════════════════════════════════
//  CLOCK
// ══════════════════════════════════════════════════════════════════
function tick() {
  const n = new Date();
  document.getElementById('clock').textContent =
    [n.getHours(), n.getMinutes(), n.getSeconds()]
    .map(x => String(x).padStart(2,'0')).join(':');
}
setInterval(tick, 1000);
tick();

// Refresh now-playing every 60s (tracks are typically 3–15 min)
setInterval(refreshNowPlaying, 60_000);

// ── INIT ──────────────────────────────────────────────────────────
buildGrid();
updateHeroStrip();
</script>
</body>
</html>
