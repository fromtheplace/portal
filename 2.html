<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FROM THE PLACE â€” TV</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=Barlow+Condensed:wght@400;600;700&display=swap" rel="stylesheet">
<style>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:          #0a0906;
  --surface:     #100e0b;
  --surface-2:   #161410;
  --border:      #201d16;
  --border-hi:   #322d20;
  --amber:       #c8943a;
  --amber-dim:   #4e380f;
  --amber-glow:  rgba(200,148,58,0.12);
  --red:         #c03030;
  --red-dim:     #3d1010;
  --crt-green:   #3dff7a;
  --text:        #9a9080;
  --text-dim:    #3a3428;
  --text-hi:     #ddd0b4;
  --text-lo:     #221e16;
  --chan-w:      272px;
  --font-disp:   'VT323', monospace;
  --font-mono:   'Share Tech Mono', monospace;
  --font-cond:   'Barlow Condensed', sans-serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-mono);
  font-size: 13px;
  line-height: 1.5;
  overflow: hidden; /* full-viewport layout */
}

/* scanlines */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 9000; pointer-events: none;
  background: repeating-linear-gradient(
    0deg, transparent, transparent 2px,
    rgba(0,0,0,0.055) 2px, rgba(0,0,0,0.055) 4px
  );
}
/* grain */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 9001; pointer-events: none;
  mix-blend-mode: overlay; opacity: 1;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.78' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.045'/%3E%3C/svg%3E");
  background-size: 200px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLASH / STATIC TRANSITION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#flash {
  position: fixed; inset: 0; z-index: 8000;
  background: #000; opacity: 0; pointer-events: none;
  transition: opacity 0.07s;
}
#flash.on { opacity: 0.9; }

#static-overlay {
  position: fixed; inset: 0; z-index: 7999; pointer-events: none;
  opacity: 0; transition: opacity 0.05s;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.4'/%3E%3C/svg%3E");
  background-size: 200px; mix-blend-mode: screen;
}
#static-overlay.flash { opacity: 0.22; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MASTHEAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#masthead {
  display: flex; align-items: stretch;
  height: 52px; flex-shrink: 0;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  position: relative; z-index: 100;
}

.mast-logo {
  display: flex; align-items: center; justify-content: center;
  padding: 6px 16px;
  border-right: 1px solid var(--border);
  flex-shrink: 0;
}
.mast-logo img {
  height: 36px; width: auto; display: block;
  filter: brightness(0.9) contrast(1.08);
}

.mast-center {
  flex: 1; display: flex; align-items: center; justify-content: center; gap: 18px;
}
.mast-on-air {
  display: flex; align-items: center; gap: 5px;
  padding: 2px 8px;
  border: 1px solid var(--red-dim);
  background: rgba(192,48,48,0.07);
}
.on-air-dot {
  width: 5px; height: 5px; border-radius: 50%; background: var(--red);
  animation: pulse 1.4s ease-in-out infinite;
}
@keyframes pulse {
  0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(192,48,48,0.5)}
  50%{opacity:0.5;box-shadow:0 0 0 5px rgba(192,48,48,0)}
}
.on-air-text {
  font-family: var(--font-mono); font-size: 8px;
  letter-spacing: 0.28em; color: var(--red); text-transform: uppercase;
}
.mast-clock {
  font-family: var(--font-disp); font-size: 26px;
  color: var(--text-dim); letter-spacing: 0.1em;
}

.mast-right {
  display: flex; align-items: center; gap: 12px;
  padding: 0 16px; border-left: 1px solid var(--border); flex-shrink: 0;
}
.mast-btn {
  font-family: var(--font-mono); font-size: 8px;
  letter-spacing: 0.22em; color: var(--text-dim); text-transform: uppercase;
  text-decoration: none; transition: color 0.15s; cursor: pointer;
  background: none; border: none;
}
.mast-btn:hover { color: var(--amber); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT â€” fills remaining viewport height
   [ player zone ] [ channel guide ]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#layout {
  display: grid;
  grid-template-columns: 1fr var(--chan-w);
  height: calc(100vh - 52px);
  overflow: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER ZONE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#player-zone {
  display: flex; flex-direction: column;
  border-right: 1px solid var(--border);
  overflow: hidden;
  background: #000;
}

/* 16:9 video container */
#player-wrap {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
  flex-shrink: 0;
  background: #000;
  overflow: hidden;
}
#player-wrap iframe {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  border: none;
}
/* YT iframe â€” overbleed to hide controls */
#yt-player iframe {
  position: absolute;
  top: -90px; bottom: -90px; left: 0; right: 0;
  width: 100%; height: calc(100% + 180px);
}

/* CRT effects on player */
#player-vignette {
  position: absolute; inset: 0; z-index: 2; pointer-events: none;
  background: radial-gradient(ellipse at center, transparent 45%, rgba(0,0,0,0.6) 100%);
}
#player-wrap::after {
  content: '';
  position: absolute; inset: 0; z-index: 3; pointer-events: none;
  background: repeating-linear-gradient(
    90deg, rgba(255,0,0,0.022) 0, rgba(255,0,0,0.022) 1px,
    transparent 1px, transparent 3px
  );
  mix-blend-mode: overlay;
}

/* placeholder shown before first tune-in */
#player-placeholder {
  position: absolute; inset: 0; z-index: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 10px;
  background: #000;
}
#player-placeholder.hide { display: none; }
.placeholder-num {
  font-family: var(--font-disp); font-size: 140px;
  color: #0e0c09; line-height: 1; letter-spacing: -6px; user-select: none;
}
.placeholder-label {
  font-family: var(--font-mono); font-size: 9px;
  letter-spacing: 0.45em; color: var(--text-dim); text-transform: uppercase;
}

/* â”€â”€ NOW PLAYING BAR â”€â”€ */
#now-playing {
  padding: 10px 18px;
  border-top: 1px solid var(--border);
  display: flex; align-items: center; gap: 14px;
  background: var(--surface); flex-shrink: 0;
}
.np-ch {
  font-family: var(--font-disp); font-size: 30px;
  color: var(--amber); min-width: 44px; letter-spacing: 0.05em; line-height: 1;
}
.np-meta { flex: 1; min-width: 0; }
.np-title {
  font-family: var(--font-cond); font-weight: 700; font-size: 14px;
  color: var(--text-hi); white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis; letter-spacing: 0.04em;
}
.np-sub {
  font-family: var(--font-mono); font-size: 9px;
  color: var(--text-dim); letter-spacing: 0.12em; margin-top: 2px;
}
.live-badge {
  display: inline-flex; align-items: center; gap: 5px;
  background: var(--red); color: #fff;
  font-family: var(--font-mono); font-size: 8px;
  letter-spacing: 0.22em; padding: 2px 7px; text-transform: uppercase; flex-shrink: 0;
}
.live-badge::before {
  content: ''; width: 5px; height: 5px; border-radius: 50%; background: #fff;
  animation: blink 1.2s step-end infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
.live-badge.off { display: none; }

/* â”€â”€ CHANNEL DESCRIPTION â”€â”€ */
#player-desc {
  flex: 1; overflow-y: auto; padding: 14px 18px;
  border-top: 1px solid var(--border);
  scrollbar-width: thin; scrollbar-color: var(--border-hi) transparent;
}
#player-desc::-webkit-scrollbar { width: 3px; }
#player-desc::-webkit-scrollbar-thumb { background: var(--border-hi); }
.desc-text {
  font-family: var(--font-mono); font-size: 11px; color: var(--text-dim);
  line-height: 1.75; max-width: 560px; letter-spacing: 0.03em;
}

/* â”€â”€ CLIP PROGRESS â”€â”€ */
#clip-bar-wrap {
  height: 2px; background: var(--border); flex-shrink: 0;
}
#clip-bar {
  height: 100%; width: 0%;
  background: var(--amber);
  box-shadow: 0 0 8px rgba(200,148,58,0.4);
  transition: width 0.5s linear;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHANNEL GUIDE (right panel)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#channel-guide {
  display: flex; flex-direction: column;
  background: var(--surface); overflow: hidden;
}

.guide-head {
  padding: 9px 13px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  flex-shrink: 0;
}
.guide-head-label {
  font-family: var(--font-mono); font-size: 8px;
  letter-spacing: 0.4em; color: var(--text-dim); text-transform: uppercase;
}
.guide-head-count {
  font-family: var(--font-disp); font-size: 20px; color: var(--text-lo);
}

#channel-list {
  flex: 1; overflow-y: auto;
  scrollbar-width: thin; scrollbar-color: var(--border-hi) transparent;
}
#channel-list::-webkit-scrollbar { width: 3px; }
#channel-list::-webkit-scrollbar-thumb { background: var(--border-hi); }

/* â”€â”€ CHANNEL TILE â”€â”€ */
.ch-tile {
  display: grid;
  grid-template-columns: 40px 1fr;
  grid-template-rows: auto auto;
  gap: 0;
  border-bottom: 1px solid var(--border);
  cursor: pointer; outline: none; user-select: none;
  border-left: 3px solid transparent;
  transition: background 0.1s, border-left-color 0.1s;
  position: relative;
}
.ch-tile:hover  { background: var(--amber-glow); border-left-color: var(--amber-dim); }
.ch-tile:focus  { background: var(--amber-glow); border-left-color: var(--amber-dim); }
.ch-tile.active { background: rgba(200,148,58,0.09); border-left-color: var(--amber); }

/* thumb row â€” 16:9 spans full width, behind num/meta */
.ch-tile-thumb {
  grid-column: 1 / -1;
  grid-row: 1;
  position: relative;
  width: 100%;
  padding-top: 40%; /* less tall than full 16:9 â€” cropped strip feel */
  overflow: hidden;
  background: #000;
}
/* static YT thumb (always shown) */
.ch-tile-thumb-static {
  position: absolute; inset: 0;
  width: 100%; height: 100%; object-fit: cover;
  filter: sepia(0.5) brightness(0.65) contrast(1.1) saturate(0.7);
  transition: opacity 0.25s; opacity: 0;
}
.ch-tile-thumb-static.loaded { opacity: 1; }
/* live YT thumb â€” cross-fades in on hover, loaded lazily */
.ch-tile-thumb-live {
  position: absolute; inset: 0;
  width: 100%; height: 100%; object-fit: cover;
  filter: brightness(0.88) contrast(1.04);
  opacity: 0; transition: opacity 0.3s;
}
.ch-tile:hover .ch-tile-thumb-live.ready { opacity: 1; }
.ch-tile:hover .ch-tile-thumb-static     { opacity: 0; }
/* fallback number plate */
.ch-tile-fb {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, #080705 0%, #131109 100%);
}
.ch-tile-fb-num {
  font-family: var(--font-disp); font-size: 42px;
  color: var(--text-lo); letter-spacing: -3px; line-height: 1;
}
/* gradient over thumb */
.ch-tile-thumb::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(0deg, rgba(10,9,6,0.82) 0%, transparent 60%);
  pointer-events: none; z-index: 2;
}
/* LIVE dot on thumb */
.ch-tile-live-dot {
  position: absolute; top: 5px; left: 6px; z-index: 3;
  display: flex; align-items: center; gap: 3px;
  background: rgba(192,48,48,0.85); padding: 1px 5px;
  font-family: var(--font-mono); font-size: 6px;
  letter-spacing: 0.2em; color: #fff; text-transform: uppercase;
}
.ch-tile-live-dot::before {
  content: ''; width: 3px; height: 3px; border-radius: 50%; background: #fff;
  animation: blink 1.1s step-end infinite;
}
.ch-tile-live-dot.off { display: none; }
/* NP text over thumb bottom */
.ch-tile-np {
  position: absolute; bottom: 0; left: 0; right: 0; z-index: 3;
  padding: 4px 7px 5px;
}
.ch-tile-np-label {
  font-family: var(--font-mono); font-size: 6px;
  letter-spacing: 0.25em; color: rgba(200,148,58,0.6); text-transform: uppercase;
  line-height: 1; margin-bottom: 1px;
}
.ch-tile-np-text {
  font-family: var(--font-disp); font-size: 14px;
  color: rgba(240,232,216,0.88); letter-spacing: 0.03em;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.1;
}
.ch-tile-np-text.loading { color: rgba(255,255,255,0.15); font-size: 10px; letter-spacing: 0.18em; }

/* meta row (num + name) */
.ch-tile-meta {
  grid-column: 1 / -1;
  grid-row: 2;
  display: grid; grid-template-columns: 40px 1fr auto;
  align-items: center; gap: 0 8px;
  padding: 6px 10px 7px 0;
}
.ch-tile-num {
  font-family: var(--font-disp); font-size: 22px;
  color: var(--text-dim); text-align: right; line-height: 1;
  padding-right: 0; transition: color 0.1s;
}
.ch-tile.active .ch-tile-num,
.ch-tile:hover .ch-tile-num { color: var(--amber); }
.ch-tile-name {
  font-family: var(--font-cond); font-weight: 700; font-size: 11px;
  letter-spacing: 0.08em; color: var(--text-hi); text-transform: uppercase;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.ch-tile-tag {
  font-family: var(--font-mono); font-size: 7px;
  letter-spacing: 0.15em; color: var(--amber-dim);
  border: 1px solid var(--border-hi); padding: 1px 4px;
  text-transform: uppercase; flex-shrink: 0;
}

/* â”€â”€ KBD HINT â”€â”€ */
.kbd-hint {
  padding: 7px 13px; border-top: 1px solid var(--border);
  display: flex; gap: 12px; flex-shrink: 0;
}
.kbd-hint span {
  font-size: 9px; color: var(--text-dim); letter-spacing: 0.08em;
  display: flex; align-items: center; gap: 4px;
}
kbd {
  display: inline-block; border: 1px solid var(--border-hi);
  padding: 1px 4px; font-size: 8px; color: var(--text-dim);
  font-family: var(--font-mono);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 860px) {
  body { overflow: auto; }
  #layout {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto;
    height: auto;
  }
  #player-zone { border-right: none; border-bottom: 1px solid var(--border); }
  #channel-guide { height: 360px; }
  #channel-list  { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
  .ch-tile-thumb { padding-top: 30%; }
}
</style>
</head>
<body>

<div id="flash"></div>
<div id="static-overlay"></div>

<!-- MASTHEAD -->
<header id="masthead">
  <div class="mast-logo">
    <img src="ftptv.png" alt="FTP TV">
  </div>
  <div class="mast-center">
    <div class="mast-on-air"><div class="on-air-dot"></div><div class="on-air-text">Broadcasting</div></div>
    <div class="mast-clock" id="clock">00:00:00</div>
  </div>
  <div class="mast-right">
    <button class="mast-btn" onclick="toggleFullscreen()">â›¶ FULL</button>
    <button class="mast-btn" onclick="toggleMute()" id="mute-btn">ğŸ”‡ MUTE</button>
  </div>
</header>

<!-- LAYOUT -->
<div id="layout">

  <!-- PLAYER ZONE -->
  <section id="player-zone">
    <div id="player-wrap">
      <!-- YT player mounts here -->
      <div id="yt-player"></div>
      <div id="player-vignette"></div>

      <!-- Shown before first tune-in -->
      <div id="player-placeholder">
        <div class="placeholder-num" id="placeholder-num">01</div>
        <div class="placeholder-label">Select a channel</div>
      </div>
    </div>

    <!-- clip progress -->
    <div id="clip-bar-wrap"><div id="clip-bar"></div></div>

    <!-- now-playing bar -->
    <div id="now-playing">
      <div class="np-ch" id="np-ch">â€”</div>
      <div class="np-meta">
        <div class="np-title" id="np-title">No signal</div>
        <div class="np-sub" id="np-sub">Select a channel to begin</div>
      </div>
      <div class="live-badge off" id="live-badge">LIVE</div>
    </div>

    <!-- description -->
    <div id="player-desc">
      <p class="desc-text" id="desc-text">Use the channel guide to tune in. Arrow keys navigate, Enter selects.</p>
    </div>
  </section>

  <!-- CHANNEL GUIDE -->
  <aside id="channel-guide">
    <div class="guide-head">
      <span class="guide-head-label">Channel Guide</span>
      <span class="guide-head-count" id="guide-count">â€”</span>
    </div>
    <div id="channel-list" role="listbox" aria-label="Channel list"></div>
    <div class="kbd-hint">
      <span><kbd>â†‘â†“</kbd> Navigate</span>
      <span><kbd>â†µ</kbd> Tune</span>
      <span><kbd>M</kbd> Mute</span>
    </div>
  </aside>

</div>

<script src="FTP_MEGA.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHANNEL REGISTRY
//
//  type 'ftpengine'  â€” FTP live broadcast. Uses FTP_MEGA.js (already loaded).
//                      Embeds YT player, wall-clock sync, full live engine.
//  type 'fetchjs'    â€” Remote channel using same stack. Fetches *_MEGA.js,
//                      derives now-playing, links out (no embedded player yet).
//  type 'yt-single'  â€” Single YT video. videoId required.
//  type 'iframe'     â€” Any embeddable URL. src required.
//  type 'placeholder'â€” No playback. Shows desc only.
//
//  thumb  â€” custom image URL or local path (priority over thumbId)
//  thumbId â€” YT video ID for static cover + hover live frame
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHANNELS = [
  {
    num:      1,
    name:     'FTP LIVE',
    tag:      'LIVE BROADCAST',
    desc:     'ÅŒtepoti Music Television â€” continuous live stream',
    live:     true,
    href:     'channel.html',
    featured: true,
    thumb:    null,
    thumbId:  null,        // set at runtime from live playlist
    nowPlaying: { type: 'ftpengine', playlist: null }, // filled after script loads
  },
  {
    num:      2,
    name:     'NOOK & CRANNY',
    tag:      'LIVE',
    desc:     'Nook & Cranny TV â€” ÅŒtepoti',
    live:     true,
    href:     'https://fromtheplace.github.io/nooktv/',
    featured: false,
    thumb:    null,
    thumbId:  null,        // will come from live playlist fetch
    nowPlaying: {
      type:    'fetchjs',
      url:     'https://fromtheplace.github.io/nooktv/NOOK_MEGA.js',
      varName: 'videoPlaylist',
    },
  },
  {
    num:      3,
    name:     'FTPtv2',
    tag:      'ARCHIVE',
    desc:     'Full sets',
    live:     true,
    href:     'https://fromtheplace.github.io/ftptv/',
    featured: false,
    thumb:    null,           // e.g. 'images/ohhh-cover.jpg'
    thumbId:  'xX6NIpgr8WA',
    nowPlaying: {
      type:    'fetchjs',
      url:     'https://fromtheplace.github.io/ftptv/FTP_MEGA.js',
      varName: 'videoPlaylist',
    },
    },
];

// Wire CH1 playlist (FTP_MEGA.js loaded via <script> above)
CHANNELS[0].nowPlaying.playlist = videoPlaylist;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FTP LIVE ENGINE  (identical to channel.html)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PLAYLIST      = videoPlaylist;
const TOTAL_SECONDS = PLAYLIST.reduce((s,t) => s + Math.max(0, t.end - t.start), 0);

function getLivePosition(playlist) {
  const total  = playlist.reduce((s,t) => s + Math.max(0, t.end - t.start), 0);
  if (!total) return { index: 0, seekOffset: 0 };
  const nowSec = Math.floor(Date.now() / 1000);
  const dayNum = Math.floor(nowSec / 86400);
  const seed   = Number((BigInt(dayNum % total) * 3571n) % BigInt(total));
  const pos    = ((nowSec % total) + seed) % total;
  let elapsed  = 0;
  for (let i = 0; i < playlist.length; i++) {
    const len = playlist[i].end - playlist[i].start;
    if (pos < elapsed + len) return { index: i, seekOffset: pos - elapsed };
    elapsed += len;
  }
  return { index: 0, seekOffset: 0 };
}

function parseTitle(title) {
  const sep   = title.includes('â€”') ? 'â€”' : ' - ';
  const parts = title.split(sep);
  return {
    artist:  parts[0].trim(),
    context: parts.slice(1).join(sep).replace(/\[.*?\]/g,'').replace(/#\w+/g,'').trim(),
  };
}

// YT player state
let ytPlayer      = null;
let ytReady       = false;
let hasTunedFtp   = false;
let _muted        = true;
let progressTimer = null;
let clipDuration  = 0;
let clipEndAt     = 0;
let pendingSeek   = null;
let advancing     = false;
let videoIndex    = 0;
let activeCh      = null;  // currently tuned CHANNELS entry

function fmt(s) { s=Math.max(0,Math.floor(s)); return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`; }

// Boot YT API
(function(){
  const t = document.createElement('script');
  t.src = 'https://www.youtube.com/iframe_api';
  document.head.appendChild(t);
})();

window.onYouTubeIframeAPIReady = function() {
  ytPlayer = new YT.Player('yt-player', {
    width: '100%', height: '100%',
    playerVars: {
      autoplay: 0, mute: 1, controls: 0, disablekb: 1,
      modestbranding: 1, rel: 0, iv_load_policy: 3, fs: 0, playsinline: 1,
    },
    events: {
      onReady:       onPlayerReady,
      onStateChange: onStateChange,
      onError:       () => advanceFtp(),
    }
  });
};

function onPlayerReady() {
  ytReady = true;
  // If CH1 was already selected before player was ready, sync now
  if (activeCh?.type === 'ftpengine') syncFtpToLive();
  if (hasTunedFtp) unmuteFtp();
}

function syncFtpToLive() {
  const { index, seekOffset } = getLivePosition(PLAYLIST);
  videoIndex = index;
  loadFtpTrack(index, seekOffset);
}

function loadFtpTrack(index, seekOffset) {
  if (!ytReady || !ytPlayer || !PLAYLIST.length) return;
  const track = PLAYLIST[index];
  if (!track) return;
  advancing = false; clearInterval(progressTimer);
  clipDuration = track.end - track.start;
  const startAt = track.start + (seekOffset || 0);
  clipEndAt = track.end; pendingSeek = startAt;
  ytPlayer.cueVideoById({ videoId: track.id, startSeconds: startAt, endSeconds: track.end });
  updateFtpOverlay(track);
}

function onStateChange(e) {
  const S = YT.PlayerState;
  if (e.data === S.CUED)     { if (pendingSeek!==null){ ytPlayer.seekTo(pendingSeek,true); pendingSeek=null; } ytPlayer.playVideo(); }
  if (e.data === S.BUFFERING){ if (pendingSeek!==null){ ytPlayer.seekTo(pendingSeek,true); pendingSeek=null; } }
  if (e.data === S.PLAYING)  {
    if (pendingSeek!==null){ const t=pendingSeek; pendingSeek=null; if(Math.abs(ytPlayer.getCurrentTime()-t)>2) ytPlayer.seekTo(t,true); }
    startProgress();
  }
  if (e.data === S.PAUSED)  clearInterval(progressTimer);
  if (e.data === S.ENDED)   { clearInterval(progressTimer); advanceFtp(); }
}

function advanceFtp() {
  if (advancing) return; advancing = true; clearInterval(progressTimer);
  flashStatic();
  setTimeout(() => { syncFtpToLive(); }, 650);
}

function startProgress() {
  clearInterval(progressTimer);
  progressTimer = setInterval(() => {
    if (!ytPlayer || !ytReady) return;
    const cur     = ytPlayer.getCurrentTime();
    const track   = PLAYLIST[videoIndex];
    const elapsed = Math.max(0, cur - track.start);
    const pct     = clipDuration > 0 ? Math.min(100, (elapsed/clipDuration)*100) : 0;
    document.getElementById('clip-bar').style.width = pct.toFixed(1) + '%';
    if (clipEndAt > 0 && cur >= clipEndAt - 0.5 && !advancing) advanceFtp();
  }, 500);
}

function updateFtpOverlay(track) {
  const p = parseTitle(track.title);
  setNowPlaying(
    String(activeCh.num).padStart(2,'0'),
    p.artist,
    p.context || activeCh.name,
    true,
    activeCh.desc
  );
  // update the active tile's np text
  updateTileNp(activeCh.num, p.artist + (p.context ? ' â€” ' + p.context : ''));
  // update live thumb videoId for active tile
  updateTileLiveId(activeCh.num, track.id);
}

function unmuteFtp() {
  if (!ytPlayer) return;
  ytPlayer.unMute(); ytPlayer.setVolume(80); _muted = false;
  document.getElementById('mute-btn').textContent = 'ğŸ”Š MUTE';
}
function muteFtp() {
  if (!ytPlayer) return;
  ytPlayer.mute(); _muted = true;
  document.getElementById('mute-btn').textContent = 'ğŸ”‡ MUTE';
}
function toggleMute() {
  if (_muted) unmuteFtp(); else muteFtp();
}
function toggleFullscreen() {
  if (!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REMOTE PLAYLIST FETCH (for fetchjs channels)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _plCache = {};
async function fetchRemotePlaylist(url, varName) {
  if (_plCache[url]) return _plCache[url];
  try {
    const res  = await fetch(url, { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const text = await res.text();
    const fn   = new Function(`${text}; return typeof ${varName}!=='undefined'?${varName}:null;`);
    const arr  = fn();
    if (!Array.isArray(arr) || !arr.length) throw new Error('empty');
    _plCache[url] = arr;
    return arr;
  } catch(e) {
    console.warn('[portal] fetch playlist', url, e.message);
    return null;
  }
}

async function resolveNowPlaying(ch) {
  const np = ch.nowPlaying;
  if (!np) return null;
  if (np.type === 'ftpengine') {
    const pl = np.playlist;
    if (!pl?.length) return null;
    const { index } = getLivePosition(pl);
    const track = pl[index];
    if (!track) return null;
    const p = parseTitle(track.title);
    return { text: p.artist + (p.context ? ' â€” ' + p.context : ''), videoId: track.id };
  }
  if (np.type === 'fetchjs') {
    const pl = await fetchRemotePlaylist(np.url, np.varName || 'videoPlaylist');
    if (!pl) return null;
    const { index } = getLivePosition(pl);
    const track = pl[index];
    if (!track) return null;
    const p = parseTitle(track.title);
    return { text: p.artist + (p.context ? ' â€” ' + p.context : ''), videoId: track.id };
  }
  if (np.type === 'static') return { text: np.text, videoId: null };
  return null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  THUMBNAILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ytThumb(id, q) { return `https://i.ytimg.com/vi/${id}/${q}.jpg`; }

function loadYtThumb(img, videoId, cb) {
  img.onerror = () => { img.onerror = () => { cb && cb(false); }; img.src = ytThumb(videoId,'hqdefault'); };
  img.onload  = () => { cb && cb(true); };
  img.src     = ytThumb(videoId, 'maxresdefault');
}

// tile live-videoId registry â€” keyed by ch.num
const tileData = {}; // num â†’ { card, staticImg, liveImg, fb, npEl, liveVideoId, liveLoaded }

function updateTileNp(num, text) {
  const d = tileData[num];
  if (!d) return;
  d.npEl.textContent = text;
  d.npEl.classList.remove('loading');
}

function updateTileLiveId(num, videoId) {
  const d = tileData[num];
  if (!d || !videoId) return;
  d.liveVideoId = videoId;
  // If hovered, trigger live load immediately
  if (d.liveLoaded) {
    loadYtThumb(d.liveImg, videoId, ok => { if (ok) d.liveImg.classList.add('ready'); });
  }
  // Also update static to live frame for active/live channels
  const ch = CHANNELS.find(c => c.num === num);
  if (ch?.live && d.staticImg) {
    d.staticImg.src = ytThumb(videoId, 'hqdefault');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DOM HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setNowPlaying(chNum, title, sub, live, desc) {
  document.getElementById('np-ch').textContent    = chNum;
  document.getElementById('np-title').textContent = title;
  document.getElementById('np-sub').textContent   = sub;
  document.getElementById('live-badge').classList.toggle('off', !live);
  document.getElementById('desc-text').textContent = desc || '';
}

function flashStatic() {
  const s = document.getElementById('static-overlay');
  s.classList.add('flash');
  setTimeout(() => s.classList.remove('flash'), 90);
}

function channelFlash(cb) {
  const f = document.getElementById('flash');
  f.classList.add('on');
  flashStatic();
  setTimeout(() => { f.classList.remove('on'); cb && cb(); }, 85);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUILD GUIDE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildGuide() {
  const list = document.getElementById('channel-list');
  document.getElementById('guide-count').textContent = `${CHANNELS.length} ch`;

  CHANNELS.forEach((ch, i) => {
    const staticSrc = ch.thumb
      ? ch.thumb
      : ch.thumbId ? ytThumb(ch.thumbId, 'hqdefault') : null;

    const tile = document.createElement('div');
    tile.className = 'ch-tile';
    tile.setAttribute('role', 'option');
    tile.setAttribute('tabindex', i === 0 ? '0' : '-1');
    tile.setAttribute('aria-label', `Channel ${ch.num}: ${ch.name}`);
    tile.dataset.index = i;

    tile.innerHTML = `
      <div class="ch-tile-thumb">
        ${staticSrc ? `<img class="ch-tile-thumb-static" alt="${ch.name}" loading="lazy">` : ''}
        <img class="ch-tile-thumb-live" alt="" aria-hidden="true">
        <div class="ch-tile-fb"${staticSrc ? ' style="display:none"' : ''}>
          <div class="ch-tile-fb-num">${String(ch.num).padStart(2,'0')}</div>
        </div>
        <div class="ch-tile-live-dot${ch.live ? '' : ' off'}">LIVE</div>
        <div class="ch-tile-np">
          <div class="ch-tile-np-label">Now Playing</div>
          <div class="ch-tile-np-text loading" data-np-tile>Â·Â·Â·</div>
        </div>
      </div>
      <div class="ch-tile-meta">
        <div class="ch-tile-num">${String(ch.num).padStart(2,'0')}</div>
        <div class="ch-tile-name">${ch.name}</div>
        ${ch.tag ? `<div class="ch-tile-tag">${ch.tag}</div>` : ''}
      </div>
    `;

    const staticImg = tile.querySelector('.ch-tile-thumb-static');
    const liveImg   = tile.querySelector('.ch-tile-thumb-live');
    const fb        = tile.querySelector('.ch-tile-fb');
    const npEl      = tile.querySelector('[data-np-tile]');
    let liveVideoId = ch.thumbId;
    let liveLoaded  = false;

    if (staticImg) {
      staticImg.addEventListener('error', () => { staticImg.style.display='none'; fb.style.display=''; });
      staticImg.addEventListener('load',  () => staticImg.classList.add('loaded'));
      staticImg.src = staticSrc;
    }

    // Lazy-load live thumb on hover
    tile.addEventListener('mouseenter', () => {
      if (liveLoaded || !liveVideoId) return;
      liveLoaded = true;
      loadYtThumb(liveImg, liveVideoId, ok => { if (ok) liveImg.classList.add('ready'); });
    });

    tile.addEventListener('click',   () => tuneToIndex(i));
    tile.addEventListener('keydown', e => handleTileKey(e, i));

    list.appendChild(tile);

    // Store refs for updates
    tileData[ch.num] = { tile, staticImg, liveImg, fb, npEl, liveVideoId, liveLoaded };

    // Resolve now-playing
    resolveNowPlaying(ch).then(result => {
      if (result?.text) {
        npEl.textContent = result.text;
        npEl.classList.remove('loading');
      } else {
        npEl.textContent = ch.nowPlaying ? 'â€”' : 'â€”';
        npEl.classList.remove('loading');
      }
      if (result?.videoId) {
        tileData[ch.num].liveVideoId = result.videoId;
        if (ch.live && staticImg) staticImg.src = ytThumb(result.videoId, 'hqdefault');
      }
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TUNE TO CHANNEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeIndex = -1;
let focusIndex  = 0;

function tuneToIndex(i) {
  const ch = CHANNELS[i];
  if (!ch) return;

  channelFlash(() => {
    // update tile active states
    document.querySelectorAll('.ch-tile').forEach((t, idx) =>
      t.classList.toggle('active', idx === i)
    );
    activeIndex = i; focusIndex = i;
    activeCh    = ch;

    // hide placeholder
    document.getElementById('player-placeholder').classList.add('hide');
    document.getElementById('placeholder-num').textContent = String(ch.num).padStart(2,'0');

    // clear progress bar on channel switch
    document.getElementById('clip-bar').style.width = '0%';

    if (ch.type === 'ftpengine') {
      // Show YT player, hide any iframe
      showYtPlayer();
      if (ytReady) {
        if (!hasTunedFtp) { hasTunedFtp = true; unmuteFtp(); }
        syncFtpToLive();
      } else {
        hasTunedFtp = true;
        setNowPlaying(String(ch.num).padStart(2,'0'), 'Loadingâ€¦', ch.name, ch.live, ch.desc);
      }
    } else if (ch.type === 'iframe' && ch.src) {
      showIframePlayer(ch.src);
      setNowPlaying(String(ch.num).padStart(2,'0'), ch.name, ch.live ? 'LIVE' : 'ON DEMAND', ch.live, ch.desc);
      // Pull now-playing for the now-playing bar too
      resolveNowPlaying(ch).then(r => {
        if (r?.text) setNowPlaying(String(ch.num).padStart(2,'0'), r.text, ch.name, ch.live, ch.desc);
      });
    } else {
      // placeholder / no playback
      showPlaceholder(ch);
      setNowPlaying(String(ch.num).padStart(2,'0'), ch.name, ch.live ? 'LIVE' : 'ARCHIVE', ch.live, ch.desc);
    }
  });
}

// â”€â”€ PLAYER SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showYtPlayer() {
  document.getElementById('yt-player').style.display = '';
  const existing = document.getElementById('ext-iframe');
  if (existing) existing.remove();
}

function showIframePlayer(src) {
  // Stop YT playback cleanly
  if (ytPlayer && ytReady) { ytPlayer.stopVideo(); clearInterval(progressTimer); }
  document.getElementById('yt-player').style.display = 'none';

  let iframe = document.getElementById('ext-iframe');
  if (!iframe) {
    iframe = document.createElement('iframe');
    iframe.id = 'ext-iframe';
    iframe.style.cssText = 'position:absolute;inset:0;width:100%;height:100%;border:none;';
    iframe.setAttribute('allowfullscreen','');
    iframe.setAttribute('allow','autoplay; fullscreen');
    document.getElementById('player-wrap').appendChild(iframe);
  }
  iframe.src = src;
}

function showPlaceholder(ch) {
  if (ytPlayer && ytReady) { ytPlayer.stopVideo(); clearInterval(progressTimer); }
  document.getElementById('yt-player').style.display = 'none';
  const existing = document.getElementById('ext-iframe');
  if (existing) existing.remove();
  // Show placeholder div with ch number
  const ph = document.getElementById('player-placeholder');
  ph.classList.remove('hide');
  document.getElementById('placeholder-num').textContent = String(ch.num).padStart(2,'0');
}

// â”€â”€ KEYBOARD NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleTileKey(e, i) {
  const tiles = document.querySelectorAll('.ch-tile');
  if (e.key === 'ArrowDown')  { e.preventDefault(); focusIndex = Math.min(focusIndex+1, tiles.length-1); moveFocus(tiles); }
  if (e.key === 'ArrowUp')    { e.preventDefault(); focusIndex = Math.max(focusIndex-1, 0); moveFocus(tiles); }
  if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); tuneToIndex(focusIndex); }
}
function moveFocus(tiles) {
  tiles.forEach((t,i) => t.setAttribute('tabindex', i===focusIndex ? '0' : '-1'));
  tiles[focusIndex].focus();
  tiles[focusIndex].scrollIntoView({ block: 'nearest' });
}

// Global keys
document.addEventListener('keydown', e => {
  if (document.activeElement?.classList.contains('ch-tile')) return;
  if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
    e.preventDefault();
    const next = activeIndex < CHANNELS.length-1 ? activeIndex+1 : 0;
    tuneToIndex(next);
    const tiles = document.querySelectorAll('.ch-tile');
    moveFocus(tiles); focusIndex = next;
  }
  if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
    e.preventDefault();
    const prev = activeIndex > 0 ? activeIndex-1 : CHANNELS.length-1;
    tuneToIndex(prev);
    const tiles = document.querySelectorAll('.ch-tile');
    moveFocus(tiles); focusIndex = prev;
  }
  if (e.key === 'm' || e.key === 'M') toggleMute();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CLOCK + REFRESH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tick() {
  const n = new Date();
  document.getElementById('clock').textContent =
    [n.getHours(),n.getMinutes(),n.getSeconds()].map(x=>String(x).padStart(2,'0')).join(':');
}
setInterval(tick, 1000); tick();

// Refresh all now-playing texts every 60s
setInterval(() => {
  Object.values(tileData).forEach(d => {
    const ch = CHANNELS.find(c => tileData[c.num] === d);
    if (!ch) return;
    resolveNowPlaying(ch).then(r => {
      if (r?.text) { d.npEl.textContent = r.text; d.npEl.classList.remove('loading'); }
      if (r?.videoId) updateTileLiveId(ch.num, r.videoId);
    });
  });
  // refresh now-playing bar if active channel is ftpengine
  if (activeCh?.type === 'ftpengine' && ytReady) {
    const track = PLAYLIST[videoIndex];
    if (track) updateFtpOverlay(track);
  }
}, 60_000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
buildGuide();

// Auto-tune to CH1 after short delay
setTimeout(() => {
  tuneToIndex(0);
  const tiles = document.querySelectorAll('.ch-tile');
  if (tiles[0]) { tiles[0].focus(); focusIndex = 0; }
}, 350);
</script>
</body>
</html>
